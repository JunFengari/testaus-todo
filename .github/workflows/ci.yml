name: CI-to-github

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    # yksikkötestit Vitestillä
    unit:
        name: Unit Tests (Vitest)
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: '20'
                  cache: 'npm'

            - name: Install dependencies
              run: npm ci

            - name: Run Vitest unit tests
              run: npm run test

    # end-to-end testit Cypressillä
    e2e:
        name: E2E Tests (Cypress)
        runs-on: ubuntu-latest
        needs: unit # yksikkötestit täytyy onnistua ennen e2e testien ajoa
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: '20'
                  cache: 'npm'

            - name: Install dependencies
              run: npm ci

            - name: Run Cypress E2E tests
              uses: cypress-io/github-action@v6
              with:
                  start: npm run dev
                  wait-on: http://localhost:5173
                  wait-on-timeout: 60
# tässä tehtävässä kopioin Heikin esimerkin toimivasta integraatio-tiedostosta
# ei heti toiminnut niin muutin push ja pull request branchit mainiksi
# ja sitten kysyin tekoälyltä miten saan molemmat testit toimimaan
# ja sillä tiedolla päädyin tähän ratkaisuun jossa testit ajetaan erikseen mutta peräkkäin.
